<html>
  <head>
    <title>Season's Greetings!</title>
    <meta property="og:title" content="Season's Greetings!" />
    <meta
      property="og:image"
      content="https://love.from.nhawk.in/s/header.png"
    />
    <meta
      property="og:video"
      content="https://love.from.nhawk.in/s/snowday.mp4"
    />

    <meta property="og:url" content="https://love.from.nhawk.in/s/" />
    <meta property="og:type" content="website" />
    <meta
      property="og:description"
      content="a little card with love from me to u"
    />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=.5, maximum-scale=12.0, minimum-scale=.1, user-scalable=yes"
    />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&family=Caramel&&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        width: 100%;
      }
      section {
        margin: calc((100vh - 64vh) / 2) auto;
        position: relative;
        width: 48vh;
        height: 64vh;
        perspective: 1000px;
      }
      #left,
      #right {
        position: absolute;
        width: 48vh;
        height: 64vh;
        text-align: center;
        box-shadow: 5px 5px 15px #333;
      }
      #left {
        background: #abc;
        transform-origin: left center;
        transition: transform 2s;
        z-index: 2;
      }
      #right {
        background: #fff;
        z-index: 1;
        overflow-y: auto;
      }
      #left.open {
        transform: rotateY(-180deg);
      }

      h1 {
        font-family: "Caramel", serif;
        color: darkred;
        font-size: 2rem;
      }

      p {
        font-family: "Berkshire Swash", serif;
        color: darkgreen;
        text-align: left;
        padding: 0 1rem;
      }

      .hidden {
        display: none;
      }
    </style>
    <script>
      window.onload = () => {
        console.log("huh");
        const messages = [
          "1QJYr8Snae3qIoHaxMxpMrUhYd+BIw==",
          "JbOb27AD+FyeZ180XKT4cwnMvf53nBIT9DcHBAos8TRGxV4buxtOh0VKUzzU2DNPaSsyLXAYQCF1qSW453JbcpewGExQmNq09vbDsLYm3UC2bseNtx46cquK1v2nF3TT3PjubsohaXfuKAFtNdzD0BTen7qubJFxzRQVOq1ob/i+nzBaOjx4lzz8njYdV8LZuyzLw6qHXj2qW++mf6473rmmdHSOWAEQ/czKAh8OmZ+eojPhlKckrcq9QWETwzvUDKGjFajQo8ZCjw2xuGSlPCF0CuE6Dd2Wy/KRgIaH4+LILa4Z0ukXMytpEYcJFBZ4Y0/N2KdzQPW/HXhZbEwqo7KHDxCFnLp5ECM6nhKZ6She6w2ivxRBluYDOsOIhYDZ/3U+X1/qVVivhHi8J7uWnoQBl4mQflQxpGFnxn8B",
        ];
        let status = "closed";

        function open() {
          if (status === "closed") {
            console.log("opening");
            document.getElementById("left").className = "open";
            status = "opening";
            setTimeout(() => {
              document.getElementById("outerCard").className = "hidden";
              document.getElementById("innerCard").className = "";
              document.getElementById("music").currentTime = 0;
              document.getElementById("music").play();
            }, 500);
            setTimeout(() => {
              status = "open";
            }, 2000);
          }
        }
        function close() {
          if (status === "open") {
            document.getElementById("left").className = "";
            status = "closing";
            setTimeout(() => {
              document.getElementById("music").pause();
              document.getElementById("outerCard").className = "";
              document.getElementById("innerCard").className = "hidden";
            }, 500);
            setTimeout(() => {
              status = "closed";
            }, 2000);
          }
        }

        function fromBase64(base64) {
          var binary = atob(base64);
          var bytes = new Uint8Array(binary.length);
          for (var i = 0; i < binary.length; i++) {
            bytes[i] = binary.charCodeAt(i);
          }
          return bytes.buffer;
        }

        async function decryptMessage(pwd, possibleMessages) {
          const encoder = new TextEncoder();
          const iv = new Uint8Array([
            163, 215, 143, 57, 240, 175, 190, 63, 61, 96, 44, 76,
          ]);
          const salt = encoder.encode("And a happy new year!");
          const key = await crypto.subtle.deriveKey(
            {
              name: "PBKDF2",
              salt,
              iterations: 100000,
              hash: "SHA-256",
            },
            await crypto.subtle.importKey(
              "raw",
              encoder.encode(pwd),
              "PBKDF2",
              false,
              ["deriveBits", "deriveKey"]
            ),
            {
              name: "AES-GCM",
              length: 256,
            },
            true,
            ["encrypt", "decrypt"]
          );
          for (message of possibleMessages) {
            try {
              const messageCypherText = fromBase64(message);
              const decrypted = await crypto.subtle.decrypt(
                {
                  name: "AES-GCM",
                  iv,
                },
                key,
                messageCypherText
              );
              return new TextDecoder().decode(decrypted);
            } catch (err) {
              console.log(err);
              // no need to do anything
            }
          }
          return null;
        }

        async function decryptAndReplaceMessage() {
          if (window.location.hash) {
            const [pwd, secret] = window.location.hash.slice(1).split(":");

            const contents = await decryptMessage(pwd, messages);
            if (contents) {
              const innerHtml = contents.replace("SECRET", secret);
              document.getElementById("message").innerHTML = innerHtml;
            }
          }
        }

        document.getElementById("outerCard").addEventListener("click", open);
        document.getElementById("innerCard").addEventListener("click", close);
        document.getElementById("right").addEventListener("click", close);

        decryptAndReplaceMessage();
        window.setTimeout(open, 10_000);
      };
    </script>
  </head>
  <body>
    <image
      src="snow6.jpg"
      width="100%"
      height="100%"
      style="position: fixed; top: 0"
    />
    <section>
      <div id="left">
        <div id="outerCard">
          <video autoplay loop muted width="100%" height="100%">
            <source src="snowday.mp4" type="video/mp4" />
          </video>
        </div>
        <image
          class="hidden"
          id="innerCard"
          src="onwards.jpg"
          width="100%"
          height="100%"
        />
      </div>
      <div id="right">
        <audio id="music" controls>
          <source src="joytotheworld.mp3" type="audio/mpeg" />
        </audio>
        <div id="message">
          <h1>Season's Greetings and a Happy Holidays!</h1>
          <p>
            Hope you are well and wishing you all the best as we head off into
            the new year!
          </p>
          <p>With love from Nolan (&amp; Olympia)</p>
        </div>
      </div>
    </section>
  </body>
</html>
